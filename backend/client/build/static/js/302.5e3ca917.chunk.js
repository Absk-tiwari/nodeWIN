"use strict";(self.webpackChunkpos=self.webpackChunkpos||[]).push([[302],{3302:(e,t,s)=>{s.r(t),s.d(t,{default:()=>j});var a=s(45),i=s(9379),n=s(5043),r=s(3003),c=s(1052),l=s(1939),d=s(8595),o=s(9722),h=s(3768),m=s(3216),x=s(6326),p=s(579);const u=["stock","id","price"];function j(){var e,t,s;const j={"Content-Type":"application/json","pos-token":localStorage.getItem("pos-token")},f=(0,n.useRef)(null),g={marginTop:".5rem",alignItems:"center",borderRadius:10,minHeight:80,border:"2px dashed",backgroundColor:"#fff",position:"relative"},y=(0,m.Zp)(),{active:v}=(0,m.g)(),[N,b]=(0,n.useState)(JSON.parse(null!==(e=localStorage.getItem("prt_receipt"))&&void 0!==e?e:"false")),{data:w,isSuccess:C}=(0,c.h3)(),{setSession:S,sessions:A,sale:k,setType:F}=(0,x.S)(),[I,O]=(0,n.useState)({Cash:0,Card:0,Account:0}),P=(0,r.wA)(),_={width:"96%",cursor:"pointer"},{currency:z,cartProducts:T,openingCash:D,cartStocks:R}=(0,r.d4)((e=>e.auth)),[q,H]=(0,n.useState)([]),[E,L]=(0,n.useState)([]),[M,U]=(0,n.useState)(I.Cash+I.Card+I.Account),[J,Q]=(0,n.useState)([]),[W,B]=(0,n.useState)(""),[G,Y]=(0,n.useState)(""),V=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){let e=I.Cash;e=parseFloat(e),O((0,i.A)((0,i.A)({},I),{},{Cash:e+parseInt(t)})),window.electronAPI&&window.electronAPI.drawCash()}else{let t=Z-Object.values(I).reduce(((e,t)=>e+parseFloat(t)),0);t<=Z&&O((()=>(0,i.A)((0,i.A)({},I),{},{[e]:t.toFixed(2)}))),U((()=>I.Cash+I.Card+I.Account))}E.includes(e)||L([...E,e]),B(e),Y("")},X=e=>{let t=G+e;Y(G+e),O((0,i.A)((0,i.A)({},I),{},{[W]:t}))},Z=null!==(t=T[parseInt(v)])&&void 0!==t&&t.length?T[parseInt(v)].reduce(((e,t)=>e+t.stock*t.price),0):J.reduce(((e,t)=>e+t.stock*t.price),0);return(0,n.useEffect)((()=>{C&&H([...w.notes].sort(((e,t)=>e.amount-t.amount)))}),[C,w]),(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{className:"content-wrapper",children:[(0,p.jsxs)("div",{className:"col-lg-12 grid-margin stretch-card",style:{justifyContent:"space-around"},children:[(0,p.jsxs)("div",{className:"col-lg-5",children:[(0,p.jsx)("div",{className:"row",style:{height:"15rem"},children:(0,p.jsx)("div",{className:"container",children:["Cash","Card","Account"].map(((e,t)=>(0,p.jsx)("div",{className:"row mt-2",children:(0,p.jsx)("div",{className:"card ms-2 payment-".concat(e.toLowerCase()," ").concat(W===e&&"active"),style:_,onClick:()=>V(e),children:(0,p.jsx)("div",{className:"card-body",children:(0,p.jsxs)("div",{className:"d-flex",style:{alignItems:"center",gap:"5px",color:"#1e283d"},children:[0===t&&(0,p.jsx)("i",{className:"mdi mdi-cash","aria-hidden":!0}),1===t&&(0,p.jsx)("i",{className:"fa fa-credit-card","aria-hidden":!0}),2===t&&(0,p.jsx)("i",{className:"fa fa-user","aria-hidden":!0}),(0,p.jsxs)("strong",{children:[" ",(0,p.jsxs)("p",{className:"m-0",children:[" ",e," "]}),"  "]})]})})})},e)))})}),k&&(0,p.jsx)("div",{className:"row",children:(0,p.jsx)("div",{className:"col-sm-12 d-flex",children:(0,p.jsxs)("button",{type:"button",className:" btn btn-light text-dark w-100 mt-3 justify-content-center",style:{width:"50%",background:"",color:"white!important"},onClick:()=>(e=>{localStorage.setItem("prt_receipt",e),b(e)})(!N),title:"print receipt",children:["Receipt",(0,p.jsx)("input",{type:"checkbox",checked:N,onChange:()=>{}})]})})}),E.length?(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{className:"calculator",children:[(0,p.jsx)("div",{className:"row mt-2 offset-2",children:[1,2,3].map(((e,t)=>(0,p.jsx)("div",{className:"col-sm-3",onClick:()=>X(e),children:(0,p.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light  w-100 text-dark",children:[" ",(0,p.jsxs)("b",{children:[" ",e," "]})," "]})},t)))}),(0,p.jsx)("div",{className:"row mt-1 offset-2",children:[4,5,6].map(((e,t)=>(0,p.jsx)("div",{className:"col-sm-3",onClick:()=>X(e),children:(0,p.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light  w-100 text-dark",children:[" ",(0,p.jsxs)("b",{children:[" ",e," "]})," "]})},t)))}),(0,p.jsx)("div",{className:"row mt-1 offset-2",children:[7,8,9].map(((e,t)=>(0,p.jsx)("div",{className:"col-sm-3",onClick:()=>X(e),children:(0,p.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light  w-100 text-dark",children:[" ",(0,p.jsxs)("b",{children:[" ",e," "]})," "]})},t)))}),(0,p.jsxs)("div",{className:"row mt-1 offset-2",children:[[0,"."].map((e=>(0,p.jsx)("div",{className:"col-sm-3 ",onClick:()=>X(e),children:(0,p.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light w-100 text-dark",children:[" ",(0,p.jsxs)("b",{children:[" ",e," "]})," "]})},e))),(0,p.jsx)("div",{className:"col-sm-3",onClick:()=>{O((0,i.A)((0,i.A)({},I),{},{[W]:0})),Y("")},children:(0,p.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light w-100 text-dark",children:[" ",(0,p.jsx)("b",{children:" Clear "})," "]})})]}),(0,p.jsx)("div",{className:"row mt-1",children:(0,p.jsx)("div",{className:"col-sm-12 d-flex",children:(0,p.jsx)("button",{type:"button",className:"w-100 btn btn-light text-white validate",style:{width:"47%",backgroundColor:"#0d172c",opacity:1},onClick:async()=>{if(0===Z)return y("/pos");if(parseFloat(I.Cash)+parseFloat(I.Card)+parseFloat(I.Account)<Z.toFixed(2))return(0,d.N5)("Pay the remainig amount!");P({type:"LOADING"});let e=parseFloat(I.Cash);e>Z.toFixed(2)&&(e=Z.toFixed(2));let t=parseFloat(I.Card);t>Z.toFixed(2)&&(t-=Z.toFixed(2),e-=t);let s=parseFloat(I.Account);s>Z.toFixed(2)&&(s-=Z.toFixed(2),e-=s);const{data:n}=await o.A.post("orders/create",{session_id:v,customer_id:"",cash_register_id:D.id,cashForDrawer:e,amount:Z,payment_mode:E.toString(),transaction_type:k?"credit":"debit",modes:(0,i.A)((0,i.A)({},I),{},{Cash:e}),sessionData:T[parseInt(v)].reduce(((e,t)=>{let{stock:s,id:i,price:n}=t;(0,a.A)(t,u);return-1===e.products.indexOf(i)&&e.products.push(i),e.quantity[i]=(e.quantity[s]||0)+s,e.total=Z,"quick"===i&&(e.otherAmount=e.otherAmount+parseFloat(n).toFixed(2)),e}),{products:[],total:0,quantity:{},otherAmount:0})},{headers:j});n.status?(h.Ay.success(k?"Order completed!":"Return completed!"),k||(localStorage.setItem("_is_sale","true"),F(!0)),localStorage.setItem("cartSessions",JSON.stringify(A.map((e=>e+1)))),S(A.map((e=>e+1))),P({type:"CHOOSEN_PRODUCT",payload:[]}),P(c.S5.util.updateQueryData("getPosProducts",void 0,(e=>{e.products=e.products.map((e=>(R.hasOwnProperty(e.id)&&(e.quantity=k?e.quantity-R[e.id]:e.quantity+R[e.id]),e)))}))),n.notifications.length&&P(c.S5.util.updateQueryData("getNotifications",void 0,(e=>{n.notifications.forEach((t=>{e.notifications.push(t)}))}))),P({type:"STOP_LOADING"}),k&&N&&(Q(T[v]),await(async()=>{const e=f.current;if(!e)return h.Ay.error("Sorry can't go further...");try{window.electronAPI?window.electronAPI.printContent({html:e.innerHTML,id:v+":"+D.id}):(0,d.N5)("Printer not connected!")}catch(t){console.error("Error capturing image:",t)}})()),y("/pos")):h.Ay.error("Failed to create the order!")},children:"Complete Payment"})})})]})}):null]}),(0,p.jsxs)("div",{className:"final col-lg-6",children:[(0,p.jsx)("div",{className:"card",children:(0,p.jsx)("div",{className:"card-body",children:(0,p.jsx)("h1",{className:"text-success",style:{textAlign:"center"},children:(0,p.jsxs)("span",{className:"total-amount",children:[!k&&"-"," ",z+parseFloat(Z).toFixed(2)]})})})}),(0,p.jsx)("div",{className:"card mt-3 w-100 parent",children:(0,p.jsxs)("div",{className:"row selections",children:[(0,p.jsx)("strong",{className:"".concat(E.length&&"d-none"),children:(0,p.jsx)("span",{className:"info",children:" Please select a payment method "})}),E.length?(0,p.jsxs)(p.Fragment,{children:[Z<Object.values(I).reduce(((e,t)=>e+parseFloat(t)),0)||Z===M?(0,p.jsx)("div",{className:"card fulfilled",children:(0,p.jsx)("div",{className:"card-body exception",children:(0,p.jsxs)("div",{className:"d-flex",style:{justifyContent:"space-between"},children:[(0,p.jsxs)("div",{className:"d-flex",children:[(0,p.jsx)("i",{className:"fa-solid fa-cash"}),(0,p.jsxs)("p",{children:[" ",k?"Return":"Put back"," "]})]}),(0,p.jsxs)("b",{children:["\xa0 ",z," ",Math.abs((Z-Object.values(I).reduce(((e,t)=>e+parseFloat(t)),0)).toFixed(2))]})]})})}):(0,p.jsx)("div",{className:"card remaining",children:(0,p.jsx)("div",{className:"card-body exception",children:(0,p.jsxs)("div",{className:"d-flex",style:{justifyContent:"space-between"},children:[(0,p.jsxs)("div",{className:"d-flex",children:[(0,p.jsx)("i",{className:"fa-solid fa-cash"}),(0,p.jsx)("p",{children:"Remaining "})]}),(0,p.jsxs)("b",{children:["\xa0 ",z," ",Math.abs((Z-Object.values(I).reduce(((e,t)=>e+parseFloat(t)),0)).toFixed(2))]})]})})}),E.map((e=>(0,p.jsx)("div",{className:"card methods payment-".concat(e.toLowerCase()," ").concat(W===e&&"active"),onClick:()=>B(e),children:(0,p.jsx)("div",{className:"card-body exception",children:(0,p.jsxs)("div",{className:"d-flex",style:{justifyContent:"space-between"},children:[(0,p.jsx)("div",{className:"d-flex",children:(0,p.jsxs)("p",{children:[" ",e," "]})}),(0,p.jsxs)("div",{className:"d-flex",children:["\xa0",z," \xa0",(0,p.jsxs)("b",{className:"price","data-paid":M,children:[" ",I[e]]}),(0,p.jsx)("i",{className:"mdi mdi-close mx-3",style:{cursor:"pointer"},onClick:()=>L((()=>(O((0,i.A)((0,i.A)({},I),{},{[e]:0})),E.filter((t=>t!==e)))))})]})]})})},e)))]}):null]})}),(0,p.jsx)("div",{className:"container",children:(0,p.jsx)("div",{className:"row",children:q.map((e=>(0,p.jsx)("div",{className:"col-sm-4 mt-1",style:{maxHeight:"110px",cursor:"pointer"},onClick:()=>V("Cash",e.amount),children:(0,p.jsx)("img",{src:"http://localhost:5100/images/"+e.image,alt:"",style:{width:"100%",height:"100%",borderRadius:10}})},e.id)))})}),(0,p.jsxs)("form",{id:"payment-form",className:"d-none",children:[(0,p.jsx)("div",{id:"pay-button"}),(0,p.jsx)("div",{className:"card-container"}),(0,p.jsxs)("button",{id:"card-button",type:"button",children:[" Pay 1 ",z]})]}),(0,p.jsx)("div",{id:"payment-status-container"})]})]}),k&&(0,p.jsx)("div",{className:"col-lg-6 ".concat(N?"":"d-none"),id:"receipt",children:(0,p.jsxs)("div",{className:"container",style:{backgroundColor:"white",paddingBottom:40,borderRadius:15,alignSelf:"center"},children:[(0,p.jsx)("div",{className:"row d-flex",children:(0,p.jsxs)("div",{style:{justifyContent:"center",display:"grid",textAlign:"center",width:"100%",fontSize:"x-large"},children:[(0,p.jsx)("img",{src:l,alt:"",style:{marginTop:30,filter:"grayscale(1)"},height:150}),(0,p.jsxs)("h2",{children:["#",v+":"+D.id]})]})}),(0,p.jsx)("div",{className:"row",ref:f,style:{justifyContent:"center"},children:(0,p.jsxs)("div",{className:"receipt",style:{width:"90%",background:"#fff"},children:[null===(s=T[v])||void 0===s?void 0:s.map((e=>(0,p.jsxs)("div",{className:"row",style:g,children:[(0,p.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"},children:[(0,p.jsx)("b",{style:{fontSize:e.name.length>35?"medium":"larger",fontWeight:900,maxWidth:"85%"},children:e.name}),(0,p.jsxs)("strong",{className:"price",style:{fontSize:"large"},children:["Qty: ",e.stock]})]}),(0,p.jsxs)("div",{style:{fontSize:"larger",width:"100%",fontWeight:900,display:"flex",justifyContent:"space-between"},children:[(0,p.jsxs)("span",{children:[" ",e.other?"":z+parseFloat(e.price).toFixed(2)+"/ Units"," "]}),(0,p.jsx)("span",{children:z+" "+parseFloat(e.stock*e.price).toFixed(2)})]})]},e.id))),(0,p.jsxs)("div",{children:[(0,p.jsxs)("div",{style:{justifyContent:"end",display:"flex",marginTop:"1.5rem"},children:[(0,p.jsx)("div",{children:(0,p.jsx)("h2",{children:"TOTAL:\xa0\xa0"})}),(0,p.jsx)("div",{children:(0,p.jsxs)("h2",{children:[" ",z+""+Z.toFixed(2)," "]})})]}),(0,p.jsx)("div",{style:{justifyContent:"end",display:"flex",width:"100%"},children:(0,p.jsx)("small",{children:"\u260e: 070-3563062"})}),(0,p.jsx)("div",{style:{textAlign:"right"},children:(0,p.jsxs)("small",{children:[(0,p.jsx)("span",{style:{color:"black",fontSize:"2rem"},children:"\ud83d\uded2"}),"Hobbemaplein 50 ",(0,p.jsx)("br",{})," 2526 JB Den Haag, Netherlands"]})})]}),(0,p.jsx)("center",{children:(0,p.jsx)("b",{children:"Thank you! Visit Again!"})})]})})]})})]})})}},8595:(e,t,s)=>{s.d(t,{C1:()=>o,E2:()=>c,N5:()=>r,Xz:()=>i,Y6:()=>h,iv:()=>d,sN:()=>l,x5:()=>n});s(8613);var a=s(3768);const i=(e,t)=>{for(var s=e.split(","),a=s[0].match(/:(.*?);/)[1],i=atob(s[s.length-1]),n=i.length,r=new Uint8Array(n);n--;)r[n]=i.charCodeAt(n);return new File([r],t,{type:a})},n=e=>{if(!e)return e;if(e.includes(" ")){let t="";return e.split(" ").forEach((e=>{t+=" "+e.charAt(0).toUpperCase()+e.slice(1)})),t}return e.charAt(0).toUpperCase()+e.slice(1)},r=e=>(0,a.Ay)(e,{icon:"\u26a0\ufe0f",style:{borderRadius:"10px",background:"#333",color:"#fff"}}),c=e=>{if(!e||"object"==typeof e)return e;3===(e=e.replace(/^#/,"")).length&&(e=e.split("").map((e=>e+e)).join(""));return{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)}},l=e=>{let t=c(e);if(void 0===t)return e;const{r:s,g:a,b:i}=t;return.299*s+.587*a+.114*i<128};function d(e,t){const s=[];if(!e)return[];arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&e.unshift({});for(let a=0;a<e.length;a+=t)s.push(e.slice(a,a+t));return s}const o=(e,t)=>{if((null===e||void 0===e?void 0:e.length)>t){return e.substring(0,t)+"..."}return e},h=e=>{const t=new Date(e),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");String(t.getSeconds()).padStart(2,"0");return"".concat(s,"-").concat(a,"-").concat(i," ").concat(n,":").concat(r)}},1939:(e,t,s)=>{e.exports=s.p+"static/media/logo.2d2e09f65e21f53b1f9f.png"}}]);
//# sourceMappingURL=302.5e3ca917.chunk.js.map
"use strict";(self.webpackChunkpos=self.webpackChunkpos||[]).push([[302],{3302:(e,t,s)=>{s.r(t),s.d(t,{default:()=>j});var a=s(45),i=s(9379),n=s(5043),r=s(3003),l=s(1052),c=s(1939),o=s(8595),d=s(9722),h=s(3768),m=s(3216),p=s(6326),x=s(579);const u=["stock","id","price","unit"];let f=0;function j(){var e,t;const s={"Content-Type":"application/json","pos-token":localStorage.getItem("pos-token")},j=(0,n.useRef)(null),g={marginTop:".5rem",alignItems:"center",borderRadius:10,border:"2px dashed",minHeight:"20px",backgroundColor:"#fff",position:"relative"},y=(0,m.Zp)(),{active:v}=(0,m.g)(),[N,b]=(0,n.useState)(JSON.parse(null!==(e=localStorage.getItem("prt_receipt"))&&void 0!==e?e:"false")),{data:w,isSuccess:C}=(0,l.h3)(),{setSession:F,sessions:S,sale:A,setType:k}=(0,p.S)(),[I,T]=(0,n.useState)({Cash:0,Card:0,Account:0}),P=(0,r.wA)(),R={width:"96%",cursor:"pointer"},{currency:M,cartProducts:O,openingCash:_,cartStocks:z}=(0,r.d4)((e=>e.auth)),[q,D]=(0,n.useState)([]),[H,E]=(0,n.useState)([]),[U,L]=(0,n.useState)(I.Cash+I.Card+I.Account),[W,B]=(0,n.useState)([]),[J,Q]=(0,n.useState)(""),[Y,G]=(0,n.useState)(""),V=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){let e=I.Cash;e=parseFloat(e),T(Z<0?(0,i.A)((0,i.A)({},I),{},{Cash:e-parseInt(t)}):(0,i.A)((0,i.A)({},I),{},{Cash:e+parseInt(t)}))}else{let t=Z-K();t<=Z&&T((()=>(0,i.A)((0,i.A)({},I),{},{[e]:t.toFixed(2)}))),L((()=>I.Cash+I.Card+I.Account))}H.includes(e)||E([...H,e]),Q(e),G("")},X=e=>{let t;"."!==e&&(t=Y+e,G(Y+e),T((0,i.A)((0,i.A)({},I),{},{[J]:t})))},Z=(()=>{var e,t;let s=0,a=0;var i;(null!==(e=O[v])&&void 0!==e&&e.length||null!==(t=W[v])&&void 0!==t&&t.length)&&(null!==(i=O[v])&&void 0!==i&&i.length?(s=O[v].filter((e=>void 0===e.return)),a=O[v].filter((e=>!0===e.return))):(s=W[v].filter((e=>void 0===e.return)),a=W[v].filter((e=>!0===e.return))),s=s.reduce(((e,t)=>e+t.stock*parseFloat(t.price)),0),a=a.reduce(((e,t)=>e+t.stock*parseFloat(t.price)),0));return f=a,parseFloat(s-a)})(),K=()=>Object.values(I).reduce(((e,t)=>e+parseFloat(t)),0);return(0,n.useEffect)((()=>{C&&D([...w.notes].sort(((e,t)=>e.amount-t.amount)))}),[C,w]),(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)("div",{className:"content-wrapper",children:[(0,x.jsxs)("div",{className:"col-lg-12 grid-margin stretch-card",style:{justifyContent:"space-around"},children:[(0,x.jsxs)("div",{className:"col-lg-5",children:[(0,x.jsx)("div",{className:"row",style:{height:"15rem"},children:(0,x.jsx)("div",{className:"container",children:["Cash","Card","Account"].map(((e,t)=>(0,x.jsx)("div",{className:"row mt-2",children:(0,x.jsx)("div",{className:"card ms-2 payment-".concat(e.toLowerCase()," ").concat(J===e&&"active"),style:R,onClick:()=>V(e),children:(0,x.jsx)("div",{className:"card-body",children:(0,x.jsxs)("div",{className:"d-flex",style:{alignItems:"center",gap:"5px",color:"#1e283d"},children:[0===t&&(0,x.jsx)("i",{className:"mdi mdi-cash","aria-hidden":!0}),1===t&&(0,x.jsx)("i",{className:"fa fa-credit-card","aria-hidden":!0}),2===t&&(0,x.jsx)("i",{className:"fa fa-user","aria-hidden":!0}),(0,x.jsxs)("strong",{children:[" ",(0,x.jsxs)("p",{className:"m-0",children:[" ",e," "]}),"  "]})]})})})},e)))})}),(0,x.jsx)("div",{className:"row",children:(0,x.jsx)("div",{className:"col-sm-12 d-flex",children:(0,x.jsxs)("button",{type:"button",className:" btn btn-light text-dark w-100 mt-3 justify-content-center",style:{width:"50%",background:"",color:"white!important"},onClick:()=>(e=>{localStorage.setItem("prt_receipt",e),b(e)})(!N),title:"print receipt",children:["Receipt",(0,x.jsx)("input",{type:"checkbox",checked:N,onChange:()=>{}})]})})}),H.length?(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)("div",{className:"calculator",children:[(0,x.jsx)("div",{className:"row mt-2 offset-2",children:[1,2,3].map(((e,t)=>(0,x.jsx)("div",{className:"col-sm-3",onClick:()=>X(e),children:(0,x.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light  w-100 text-dark",children:[" ",(0,x.jsxs)("b",{children:[" ",e," "]})," "]})},t)))}),(0,x.jsx)("div",{className:"row mt-1 offset-2",children:[4,5,6].map(((e,t)=>(0,x.jsx)("div",{className:"col-sm-3",onClick:()=>X(e),children:(0,x.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light  w-100 text-dark",children:[" ",(0,x.jsxs)("b",{children:[" ",e," "]})," "]})},t)))}),(0,x.jsx)("div",{className:"row mt-1 offset-2",children:[7,8,9].map(((e,t)=>(0,x.jsx)("div",{className:"col-sm-3",onClick:()=>X(e),children:(0,x.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light  w-100 text-dark",children:[" ",(0,x.jsxs)("b",{children:[" ",e," "]})," "]})},t)))}),(0,x.jsxs)("div",{className:"row mt-1 offset-2",children:[[0,"."].map((e=>(0,x.jsx)("div",{className:"col-sm-3 ",onClick:()=>X(e),children:(0,x.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light w-100 text-dark",children:[" ",(0,x.jsxs)("b",{children:[" ",e," "]})," "]})},e))),(0,x.jsx)("div",{className:"col-sm-3",onClick:()=>{T((0,i.A)((0,i.A)({},I),{},{[J]:0})),G("")},children:(0,x.jsxs)("button",{style:{fontSize:"1.5rem"},className:"btn btn-light w-100 text-dark",children:[" ",(0,x.jsx)("b",{children:" Clear "})," "]})})]}),(0,x.jsx)("div",{className:"row mt-1",children:(0,x.jsx)("div",{className:"col-sm-12 d-flex",children:(0,x.jsx)("button",{type:"button",className:"w-100 btn btn-light text-white validate",style:{width:"47%",backgroundColor:"#0d172c",opacity:1,textTransform:"uppercase"},onClick:async()=>{if(0===Z)return y("/pos");let e=parseFloat(I.Cash)+parseFloat(I.Card)+parseFloat(I.Account);if(Z>0&&e<Z.toFixed(2))return(0,o.N5)("Pay the remaining amount!");if(Z<0&&(0,o.f)(e)<(0,o.f)(Z))return(0,o.N5)("Return the remaining amount!");let t=Z.toFixed(2),n=parseFloat(I.Card);n>0&&n>Z.toFixed(2)&&(n-=Z.toFixed(2),t-=n);let r=parseFloat(I.Account);r>0&&r>Z.toFixed(2)&&(r-=Z.toFixed(2),t-=r);const{data:c}=await d.A.post("orders/create",{session_id:v,customer_id:"",cash_register_id:_.id,cashForDrawer:t,amount:Z,payment_mode:H.toString(),transaction_type:A?"credit":"debit",modes:(0,i.A)((0,i.A)({},I),{},{Cash:t}),returns:f,sessionData:O[v].reduce(((e,t)=>{let{stock:s,id:i,price:n,unit:r}=t,l=(0,a.A)(t,u);return-1===e.products.indexOf(i)&&e.products.push(i),e.quantity[i]=(e.quantity[s]||0)-0+(s-0),e.total=Z,e.unit[i]=null!==r&&void 0!==r?r:null,e.price[i]=l.return?-(e.quantity[i]||0)*n:(e.quantity[i]||0)*n,"quick"===i&&(e.otherAmount=e.otherAmount+parseFloat(n).toFixed(2)),e}),{products:[],total:0,quantity:{},otherAmount:0,unit:{},price:{}})},{headers:s});var m;c.status?(h.Ay.success(A?"Order completed!":"Return completed!"),A||(localStorage.setItem("_is_sale","true"),k(!0)),null===(m=window.electronAPI)||void 0===m||m.reloadWindow({manual:!0}),localStorage.setItem("cartSessions",JSON.stringify(S.map((e=>e+1)))),F(S.map((e=>e+1))),P({type:"CHOOSEN_PRODUCT",payload:[]}),P(l.S5.util.updateQueryData("getPosProducts",void 0,(e=>{e.products=e.products.map((e=>(z.hasOwnProperty(e.id)&&(e.quantity=A?e.quantity-z[e.id]:e.quantity+z[e.id]),e)))}))),c.notifications.length&&P(l.S5.util.updateQueryData("getNotifications",void 0,(e=>{c.notifications.forEach((t=>{e.notifications.push(t)}))}))),P({type:"STOP_LOADING"}),N&&(B(O[v]),await(async()=>{const e=j.current;if(!e)return h.Ay.error("Sorry can't go further...");try{window.electronAPI?window.electronAPI.printContent({html:e.innerHTML,id:v+":"+_.id}):(0,o.N5)("Printer not connected!")}catch(t){console.error("Error capturing image:",t)}})()),y("/pos")):h.Ay.error("Failed to create the order!")},children:"Complete Payment"})})})]})}):null]}),(0,x.jsxs)("div",{className:"final col-lg-6",children:[(0,x.jsx)("div",{className:"card",children:(0,x.jsx)("div",{className:"card-body",children:(0,x.jsx)("h1",{className:"text-success",style:{textAlign:"center"},children:(0,x.jsx)("span",{className:"total-amount",children:M+parseFloat(Z).toFixed(2)})})})}),(0,x.jsx)("div",{className:"card mt-3 w-100 parent",children:(0,x.jsxs)("div",{className:"row selections",children:[(0,x.jsx)("strong",{className:"".concat(H.length&&"d-none"),children:(0,x.jsx)("span",{className:"info",children:" Please select a payment method "})}),H.length?(0,x.jsxs)(x.Fragment,{children:[Z<K()||Z===U?(0,x.jsx)("div",{className:"card ".concat(K()>Z?"fulfilled":"remaining"),children:(0,x.jsx)("div",{className:"card-body exception",children:(0,x.jsx)("div",{className:"d-flex",style:{justifyContent:"space-between"},children:Z>0?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{className:"d-flex",children:[(0,x.jsx)("i",{className:"fa-solid fa-cash"}),(0,x.jsx)("p",{children:" Return "})]}),(0,x.jsxs)("b",{children:["\xa0 ",M," ",Math.abs((Z-K()).toFixed(2))]})]}):(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)("div",{className:"d-flex",children:[(0,x.jsx)("i",{className:"fa-solid fa-cash"}),Z>0&&K()>Z?(0,x.jsxs)("b",{children:[" Put back ",Z.toFixed(2)-K()]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("p",{children:" Return "}),(0,x.jsxs)("b",{children:[" \xa0 ",M+Math.abs(Z.toFixed(2)-K())]})]})]})})})})}):(0,x.jsx)("div",{className:"card remaining",children:(0,x.jsx)("div",{className:"card-body exception",children:(0,x.jsxs)("div",{className:"d-flex",style:{justifyContent:"space-between"},children:[(0,x.jsxs)("div",{className:"d-flex",children:[(0,x.jsx)("i",{className:"fa-solid fa-cash"}),Z>0?(0,x.jsx)("p",{children:"Remaining "}):(0,x.jsx)("p",{children:"Put Back"})]}),(0,x.jsxs)("b",{children:["\xa0 ",M," ",Math.abs((Z-K()).toFixed(2))]})]})})}),H.map((e=>(0,x.jsx)("div",{className:"card methods payment-".concat(e.toLowerCase()," ").concat(J===e&&"active"),onClick:()=>Q(e),children:(0,x.jsx)("div",{className:"card-body exception",children:(0,x.jsxs)("div",{className:"d-flex",style:{justifyContent:"space-between"},children:[(0,x.jsx)("div",{className:"d-flex",children:(0,x.jsxs)("p",{children:[" ",e," "]})}),(0,x.jsxs)("div",{className:"d-flex",children:["\xa0",M," \xa0",(0,x.jsxs)("b",{className:"price",children:[" ",I[e]]}),(0,x.jsx)("i",{className:"mdi mdi-close mx-3",style:{cursor:"pointer"},onClick:()=>E((()=>(T((0,i.A)((0,i.A)({},I),{},{[e]:0})),H.filter((t=>t!==e)))))})]})]})})},e)))]}):null]})}),(0,x.jsx)("div",{className:"container",children:(0,x.jsx)("div",{className:"row",children:[5,10,20,50,100,200].map((e=>(0,x.jsx)("div",{className:"col-sm-4 mt-1",style:{maxHeight:"110px",cursor:"pointer"},onClick:()=>V("Cash",e),children:(0,x.jsx)("div",{className:"text-center bg-white",style:{width:"100%",height:"100px",borderRadius:10,border:"1px solid",placeContent:"center"},children:(0,x.jsxs)("h2",{children:[" ",(0,x.jsxs)("b",{children:["EUR ",e]})," "]})})},e)))})})]})]}),(0,x.jsx)("div",{className:"col-lg-5 ms-4 ".concat(N?"":"d-none"),id:"receipt",children:(0,x.jsxs)("div",{className:"container",style:{backgroundColor:"white",paddingBottom:40,borderRadius:15,alignSelf:"center"},children:[(0,x.jsx)("div",{className:"row d-flex w-100",children:(0,x.jsx)("div",{style:{justifyContent:"center",display:"grid",textAlign:"center",width:"100%"},children:(0,x.jsx)("img",{src:c,alt:"",style:{marginTop:30,filter:"grayscale(1)"},height:150})})}),(0,x.jsxs)("div",{className:"row",ref:j,style:{justifyContent:"center"},children:[(0,x.jsx)("div",{children:(0,x.jsx)("div",{style:{textAlign:"center",marginTop:10},children:(0,x.jsxs)("h5",{style:{textTransform:"uppercase",fontFamily:"Manrope, sans-serif"},children:[(0,x.jsx)("b",{style:{paddingTop:10},children:"\u260e: 070-3563062"}),(0,x.jsx)("br",{}),(0,x.jsx)("span",{children:"\ud83d\uded2"}),"Hobbemaplein 50 ",(0,x.jsx)("br",{})," 2526 JB Den Haag, Netherlands",(0,x.jsx)("br",{})]})})}),(0,x.jsxs)("div",{className:"receipt",style:{width:"90%",background:"#fff"},children:[null===(t=O[v])||void 0===t?void 0:t.map((e=>(0,x.jsxs)("div",{className:"row",style:g,children:[(0,x.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"},children:[(0,x.jsx)("b",{style:{fontSize:e.name.length>35?"medium":"larger",fontWeight:900,maxWidth:"80%",fontFamily:"Manrope, sans-serif"},children:e.name}),(0,x.jsx)("strong",{className:"price",style:{fontSize:"large",whiteSpace:"nowrap"},children:"".concat(e.return?"- ":"")+M+" "+parseFloat(e.stock*e.price).toFixed(2)})]}),(0,x.jsxs)("div",{className:"toHide",style:{fontSize:"larger",width:"100%",fontWeight:900,display:"flex",justifyContent:"space-between"},children:[(0,x.jsx)("span",{style:{fontFamily:"Manrope, sans-serif"},children:e.other?"":M+parseFloat(e.price).toFixed(2)+(e.unit?"/ ".concat(e.unit):"/ Units")}),(0,x.jsxs)("span",{style:{fontFamily:"Manrope, sans-serif"},children:[" Qty: ",parseFloat(e.stock).toFixed(2)," ",e.unit?e.unit:""]})]})]},e.id))),(0,x.jsxs)("h1",{style:{cssText:"font-size:1.75rem!important;font-weight:600;font-family:Manrope, sans-serif"},children:[" TOTAL \xa0 ",M+" "+parseFloat(Z).toFixed(2)]})]}),(0,x.jsx)("p",{style:{paddingTop:10,fontFamily:"Manrope, sans-serif"},children:"Thank you! Visit Again!"})]})]})})]})})}},8595:(e,t,s)=>{s.d(t,{C1:()=>d,E2:()=>l,N5:()=>r,Xz:()=>i,Y6:()=>h,f:()=>m,iv:()=>o,sN:()=>c,x5:()=>n});s(8613);var a=s(3768);const i=(e,t)=>{for(var s=e.split(","),a=s[0].match(/:(.*?);/)[1],i=atob(s[s.length-1]),n=i.length,r=new Uint8Array(n);n--;)r[n]=i.charCodeAt(n);return new File([r],t,{type:a})},n=e=>{if(!e)return e;if(e.includes(" ")){let t="";return e.split(" ").forEach((e=>{t+=" "+e.charAt(0).toUpperCase()+e.slice(1)})),t}return e.charAt(0).toUpperCase()+e.slice(1)},r=e=>(0,a.Ay)(e,{icon:"\u26a0\ufe0f",style:{borderRadius:"10px",background:"#333",color:"#fff"}}),l=e=>{if(!e||"object"==typeof e)return e;3===(e=e.replace(/^#/,"")).length&&(e=e.split("").map((e=>e+e)).join(""));return{r:parseInt(e.slice(0,2),16),g:parseInt(e.slice(2,4),16),b:parseInt(e.slice(4,6),16)}},c=e=>{let t=l(e);if(void 0===t)return e;const{r:s,g:a,b:i}=t;return.299*s+.587*a+.114*i<128};function o(e,t){const s=[];if(!e)return[];arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&e.unshift({});for(let a=0;a<e.length;a+=t)s.push(e.slice(a,a+t));return s}const d=(e,t)=>{if((null===e||void 0===e?void 0:e.length)>t){return e.substring(0,t)+"..."}return e},h=e=>{const t=new Date(e),s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),n=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0");String(t.getSeconds()).padStart(2,"0");return"".concat(s,"-").concat(a,"-").concat(i," ").concat(n,":").concat(r)},m=e=>parseFloat(e).toFixed(2)},1939:(e,t,s)=>{e.exports=s.p+"static/media/logo.2d2e09f65e21f53b1f9f.png"}}]);
//# sourceMappingURL=302.d382534e.chunk.js.map